<view class="user-manage-page">
  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <view class="user-list-section">
    <view class="section-title">
      <text class="title-text">ç”¨æˆ·åˆ—è¡¨</text>
      <text class="title-count">ï¼ˆ{{userList.length}}äººï¼‰</text>
    </view>

    <view class="user-list">
      <view 
        class="user-card" 
        wx:for="{{userList}}" 
        wx:key="userId"
      >
        <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
        <view class="user-header" data-user-id="{{item.userId}}" bindtap="toggleUserExpanded">
          <view class="user-avatar">
            <image 
              class="avatar-image" 
              src="{{item.avatarUrl || '/static/images/default-avatar.png'}}" 
              mode="aspectFill"
            />
          </view>
          
          <view class="user-info">
            <view class="user-name">{{item.nickname || 'æœªçŸ¥ç”¨æˆ·'}}</view>
            <view class="user-meta">
              <text class="course-count">{{item.courseCount}}é—¨è¯¾ç¨‹</text>
            </view>
            <view class="user-contact" wx:if="{{item.phone || item.email}}">
              <text wx:if="{{item.phone}}" class="contact-item">ğŸ“± {{item.phone}}</text>
              <text wx:if="{{item.email}}" class="contact-item">âœ‰ï¸ {{item.email}}</text>
            </view>
          </view>

          <view class="expand-icon">
            <text class="icon {{expandedUsers[item.userId] ? 'expanded' : ''}}">â–¼</text>
          </view>
        </view>

        <!-- å±•å¼€çš„è¯¾ç¨‹åˆ—è¡¨ -->
        <view class="user-courses" wx:if="{{expandedUsers[item.userId]}}">
          <view class="courses-header">
            <text class="courses-title">æ³¨å†Œçš„è¯¾ç¨‹</text>
            <view class="action-buttons">
              <button 
                class="detail-btn" 
                size="mini"
                data-user-id="{{item.userId}}" 
                bindtap="viewUserDetail"
              >
                æŸ¥çœ‹è¯¦æƒ…
              </button>
            </view>
          </view>

          <view class="course-list">
            <view 
              class="course-item" 
              wx:for="{{item.courses}}" 
              wx:for-item="course"
              wx:key="courseId"
            >
              <view class="course-info">
                <text class="course-title">{{course.courseTitle}}</text>
                <view class="course-meta">
                  <text class="registration-type">{{course.registrationTypeText}}</text>
                  <text class="registration-date">{{course.formattedCreatedAt}}</text>
                </view>
              </view>
              

            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && userList.length === 0}}">
      <image class="empty-icon" src="/static/icon/person.png" mode="aspectFit" />
      <text class="empty-text">æš‚æ— ç”¨æˆ·æ•°æ®</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡† -->
  <view class="user-detail-modal" wx:if="{{showUserDetail}}" bindtap="hideUserDetail">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç”¨æˆ·è¯¦æƒ…</text>
        <view class="close-btn" bindtap="hideUserDetail">âœ•</view>
      </view>
      
      <view class="modal-body">
        <!-- åŸºæœ¬ä¿¡æ¯è¡¨å• -->
        <view class="form-section">
          <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
          
          <view class="form-item">
            <text class="form-label">æ˜µç§°</text>
            <text class="form-value">{{userDetailInfo.nickname || 'æœªçŸ¥ç”¨æˆ·'}}</text>
          </view>
          
          <view class="form-item" wx:if="{{userDetailInfo.phone}}">
            <text class="form-label">æ‰‹æœº</text>
            <text class="form-value">{{userDetailInfo.phone}}</text>
          </view>
          
          <view class="form-item" wx:if="{{userDetailInfo.email}}">
            <text class="form-label">é‚®ç®±</text>
            <text class="form-value">{{userDetailInfo.email}}</text>
          </view>
          
          <view class="form-item">
            <text class="form-label">è§’è‰²</text>
            <text class="form-value">{{userDetailInfo.roleText}}</text>
          </view>
          
          <view class="form-item">
            <text class="form-label">ç­‰çº§</text>
            <text class="form-value">{{userDetailInfo.level || 'æ–°æ‰‹'}}</text>
          </view>
          
          <view class="form-item">
            <text class="form-label">æ³¨å†Œæ—¶é—´</text>
            <text class="form-value">{{userDetailInfo.registrationDate}}</text>
          </view>
        </view>
        
        <!-- å­¦ä¹ ç»Ÿè®¡è¡¨å• -->
        <view class="form-section">
          <view class="section-title">å­¦ä¹ ç»Ÿè®¡</view>
          
          <view class="form-item">
            <text class="form-label">å·²æ³¨å†Œè¯¾ç¨‹</text>
            <text class="form-value">{{userDetailInfo.totalCourses}} é—¨</text>
          </view>
          

          
          <view class="form-item" wx:if="{{userDetailInfo.totalCourses === 0}}">
            <text class="form-label">å­¦ä¹ çŠ¶æ€</text>
            <text class="form-value">æš‚æ— å­¦ä¹ è®°å½•</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="confirm-btn" bindtap="hideUserDetail">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view> 