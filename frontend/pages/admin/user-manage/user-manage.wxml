<view class="user-manage-page">
  <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="statistics-section">
    <view class="stats-card">
      <view class="stats-item">
        <text class="stats-number">{{statistics.totalUsers || 0}}</text>
        <text class="stats-label">æ€»ç”¨æˆ·æ•°</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{statistics.totalRegistrations || 0}}</text>
        <text class="stats-label">æ€»æ³¨å†Œè¯¾ç¨‹æ•°</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{statistics.completedCourses || 0}}</text>
        <text class="stats-label">å·²å®Œæˆè¯¾ç¨‹æ•°</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{statistics.completionRate ? statistics.completionRate.toFixed(1) : 0}}%</text>
        <text class="stats-label">å®Œæˆç‡</text>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <view class="user-list-section">
    <view class="section-title">
      <text class="title-text">ç”¨æˆ·åˆ—è¡¨</text>
      <text class="title-count">ï¼ˆ{{userList.length}}äººï¼‰</text>
    </view>

    <view class="user-list">
      <view 
        class="user-card" 
        wx:for="{{userList}}" 
        wx:key="userId"
      >
        <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
        <view class="user-header" data-user-id="{{item.userId}}" bindtap="toggleUserExpanded">
          <view class="user-avatar">
            <image 
              class="avatar-image" 
              src="{{item.avatarUrl || '/static/images/default-avatar.png'}}" 
              mode="aspectFill"
            />
          </view>
          
          <view class="user-info">
            <view class="user-name">{{item.nickname || 'æœªçŸ¥ç”¨æˆ·'}}</view>
            <view class="user-meta">
              <text class="course-count">{{item.courseCount}}é—¨è¯¾ç¨‹</text>
              <text class="completion-rate">å®Œæˆç‡ {{item.completionRate}}%</text>
            </view>
            <view class="user-contact" wx:if="{{item.phone || item.email}}">
              <text wx:if="{{item.phone}}" class="contact-item">ğŸ“± {{item.phone}}</text>
              <text wx:if="{{item.email}}" class="contact-item">âœ‰ï¸ {{item.email}}</text>
            </view>
          </view>

          <view class="expand-icon">
            <text class="icon {{expandedUsers[item.userId] ? 'expanded' : ''}}">â–¼</text>
          </view>
        </view>

        <!-- å±•å¼€çš„è¯¾ç¨‹åˆ—è¡¨ -->
        <view class="user-courses" wx:if="{{expandedUsers[item.userId]}}">
          <view class="courses-header">
            <text class="courses-title">æ³¨å†Œçš„è¯¾ç¨‹</text>
            <view class="action-buttons">
              <button 
                class="detail-btn" 
                size="mini"
                data-user-id="{{item.userId}}" 
                bindtap="viewUserDetail"
              >
                æŸ¥çœ‹è¯¦æƒ…
              </button>
            </view>
          </view>

          <view class="course-list">
            <view 
              class="course-item" 
              wx:for="{{item.courses}}" 
              wx:for-item="course"
              wx:key="courseId"
            >
              <view class="course-info">
                <text class="course-title">{{course.courseTitle}}</text>
                <view class="course-meta">
                  <text class="registration-type">{{course.registrationTypeText}}</text>
                  <text class="registration-date">{{course.formattedCreatedAt}}</text>
                </view>
              </view>
              
              <view class="course-progress">
                <view class="progress-bar">
                  <view 
                    class="progress-fill" 
                    style="width: {{course.progress}}%"
                  ></view>
                </view>
                <text class="progress-text">{{course.progress}}%</text>
                <text class="status-badge {{course.isCompleted ? 'completed' : 'learning'}}">
                  {{course.isCompleted ? 'å·²å®Œæˆ' : 'å­¦ä¹ ä¸­'}}
                </text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && userList.length === 0}}">
      <image class="empty-icon" src="/static/icon/person.png" mode="aspectFit" />
      <text class="empty-text">æš‚æ— ç”¨æˆ·æ•°æ®</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view> 