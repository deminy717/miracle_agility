<view class="chapter-manage-page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ç« èŠ‚ç®¡ç†</text>
    <text class="page-subtitle">{{courseInfo.title}}</text>
  </view>

  <!-- è¯¾ç¨‹ä¿¡æ¯å¡ç‰‡ -->
  <view class="course-info-card">
    <view class="course-cover">
      <image src="{{courseInfo.cover}}" mode="aspectFill" />
    </view>
    <view class="course-details">
      <text class="course-title">{{courseInfo.title}}</text>
      <view class="course-stats">
        <text class="stat-item">{{chapters.length}}ä¸ªç« èŠ‚</text>
      </view>
    </view>
  </view>

  <!-- ç« èŠ‚åˆ—è¡¨ -->
  <view class="chapters-section">
    <view class="section-header">
      <text class="section-title">ç« èŠ‚åˆ—è¡¨</text>
      <button class="add-chapter-btn" bindtap="addChapter">
        <text class="btn-icon">+</text>
        <text class="btn-text">æ–°å¢ç« èŠ‚</text>
      </button>
    </view>

    <view class="chapters-list">
      <view 
        class="chapter-item" 
        wx:for="{{chapters}}" 
        wx:key="id"
      >
        <!-- ç« èŠ‚å¤´éƒ¨ -->
        <view class="chapter-header" bindtap="viewChapter" data-chapter="{{item}}">
          <view class="chapter-number">{{index + 1}}</view>
          <view class="chapter-info">
            <text class="chapter-title">{{item.title}}</text>
            <text class="chapter-description">{{item.description}}</text>
            <view class="chapter-meta">
              <text class="meta-item">{{item.lessonCount || 0}}ä¸ªè¯¾æ—¶</text>
              <text class="meta-item status-{{item.status}}">{{item.status === 'published' ? 'å·²å‘å¸ƒ' : 'è‰ç¨¿'}}</text>
            </view>
          </view>
          
          <view class="chapter-actions">
            <view class="switch-container" catchtap="toggleChapterStatus" data-id="{{item.id}}">
              <view class="switch {{item.status === 'published' ? 'switch-on' : 'switch-off'}}">
                <view class="switch-handle"></view>
              </view>
            </view>
            <view class="action-btn edit-btn" catchtap="editChapter" data-id="{{item.id}}" data-title="{{item.title}}">
              <text class="btn-text">ç¼–è¾‘ç« èŠ‚</text>
            </view>
            <view class="action-btn add-subchapter-btn" catchtap="addSubChapter" data-id="{{item.id}}" data-title="{{item.title}}">
              <text class="btn-text">æ–°å¢å†…å®¹</text>
            </view>
            <view class="action-btn delete-btn" catchtap="deleteChapter" data-id="{{item.id}}">
              <text class="btn-text">åˆ é™¤ç« èŠ‚</text>
            </view>
          </view>
        </view>

        <!-- è¯¾æ—¶åˆ—è¡¨ -->
        <view class="lessons-section" wx:if="{{item.lessons && item.lessons.length > 0}}">
          <view class="lessons-header">
            <text class="lessons-title">ğŸ“š è¯¾æ—¶åˆ—è¡¨</text>
          </view>
          <view class="lessons-list">
            <view 
              class="lesson-item" 
              wx:for="{{item.lessons}}" 
              wx:for-item="lesson"
              wx:key="id"
              bindtap="viewLesson"
              data-lesson-id="{{lesson.id}}"
              data-lesson="{{lesson}}"
            >
              <view class="lesson-number">{{lesson.chapterLessonOrder}}</view>
              <view class="lesson-info">
                <text class="lesson-title">{{lesson.title}}</text>
                <text class="lesson-description">{{lesson.description}}</text>
                <view class="lesson-meta">
                  <text class="meta-item status-{{lesson.status}}">{{lesson.status === 'published' ? 'å·²å‘å¸ƒ' : 'è‰ç¨¿'}}</text>
                </view>
              </view>
              
              <view class="lesson-actions">
                <view class="lesson-switch-container" catchtap="toggleLessonStatus" 
                      data-lesson-id="{{lesson.id}}" 
                      data-title="{{lesson.title}}">
                  <view class="lesson-switch {{lesson.status === 'published' ? 'switch-on' : 'switch-off'}}">
                    <view class="lesson-switch-handle"></view>
                  </view>
                </view>
                <view class="action-btn edit-lesson-btn" catchtap="editLesson" 
                      data-lesson-id="{{lesson.id}}" 
                      data-chapter-id="{{item.id}}" 
                      data-title="{{lesson.title}}">
                  <text class="btn-text">ç¼–è¾‘è¯¾æ—¶</text>
                </view>
                <view class="action-btn delete-lesson-btn" catchtap="deleteLesson" 
                      data-lesson-id="{{lesson.id}}" 
                      data-title="{{lesson.title}}">
                  <text class="btn-text">åˆ é™¤è¯¾æ—¶</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- æ— è¯¾æ—¶çŠ¶æ€ -->
        <view class="no-lessons" wx:if="{{!item.lessons || item.lessons.length === 0}}">
          <text class="no-lessons-text">æš‚æ— è¯¾æ—¶</text>
          <text class="no-lessons-tip">ç‚¹å‡»ä¸Šæ–¹ğŸ“æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªè¯¾æ—¶</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{chapters.length === 0}}">
      <text class="empty-icon">ğŸ“–</text>
      <text class="empty-text">æš‚æ— ç« èŠ‚</text>
      <text class="empty-tip">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªç« èŠ‚</text>
    </view>
  </view>
</view>