<!--å¡ç‰‡å¼å†…å®¹ç¼–è¾‘å™¨-->
<view class="card-editor-container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <text class="back-btn" bindtap="goBack">â†</text>
    <text class="page-title">å†…å®¹ç¼–è¾‘å™¨</text>
    <text class="save-btn" bindtap="saveContent">ä¿å­˜</text>
  </view>

  <!-- è¯¾ç¨‹ä¿¡æ¯ -->
  <view class="course-info">
    <input class="course-title" 
           placeholder="è¯·è¾“å…¥è¯¾ç¨‹æ ‡é¢˜" 
           value="{{courseInfo.title}}" 
           bindinput="onTitleInput"/>
    <input class="course-subtitle" 
           placeholder="è¯·è¾“å…¥ç« èŠ‚ä¿¡æ¯" 
           value="{{courseInfo.subtitle}}" 
           bindinput="onSubtitleInput"/>
  </view>

  <!-- å†…å®¹å¡ç‰‡ -->
  <scroll-view class="content-scroll" scroll-y>
    <view class="content-cards">
      <view class="content-card" wx:for="{{contentCards}}" wx:key="id">
        
        <!-- å¡ç‰‡å¤´éƒ¨ -->
        <view class="card-header">
          <view class="card-type {{item.type}}">{{item.typeName}}</view>
          <view class="card-actions">
            <text class="action-btn" bindtap="moveUp" data-index="{{index}}">â†‘</text>
            <text class="action-btn" bindtap="moveDown" data-index="{{index}}">â†“</text>
            <text class="action-btn delete" bindtap="deleteCard" data-index="{{index}}">Ã—</text>
          </view>
        </view>

        <!-- è§†é¢‘å¡ç‰‡ -->
        <view wx:if="{{item.type === 'video'}}" class="video-content">
          <view wx:if="{{item.videoUrl}}" class="video-preview">
            <video src="{{item.videoUrl}}" controls class="video-player"></video>
            <view class="video-stats">
              <text>ğŸ¬ {{item.duration || '30åˆ†é’Ÿ'}}</text>
              <text>ğŸ‘¥ {{item.views || '156äººå­¦ä¹ '}}</text>
            </view>
          </view>
          <view wx:else class="video-placeholder" bindtap="selectVideo" data-index="{{index}}">
            <text class="placeholder-icon">ğŸ“¹</text>
            <text>ç‚¹å‡»æ·»åŠ è§†é¢‘</text>
          </view>
        </view>

        <!-- æ–‡æœ¬å¡ç‰‡ -->
        <view wx:elif="{{item.type === 'text'}}" class="text-content">
          <input placeholder="æ®µè½æ ‡é¢˜" 
                 value="{{item.title}}"
                 bindinput="onTextTitleInput"
                 data-index="{{index}}"
                 class="text-title"/>
          <textarea placeholder="è¯·è¾“å…¥æ–‡æœ¬å†…å®¹..." 
                    value="{{item.content}}"
                    bindinput="onTextContentInput"
                    data-index="{{index}}"
                    class="text-area">
          </textarea>
        </view>

        <!-- å›¾ç‰‡å¡ç‰‡ -->
        <view wx:elif="{{item.type === 'image'}}" class="image-content">
          <view wx:if="{{item.imageUrl}}" class="image-preview">
            <image src="{{item.imageUrl}}" mode="aspectFill" class="image-display"></image>
            <text class="change-image-btn" bindtap="selectImage" data-index="{{index}}">æ›´æ¢å›¾ç‰‡</text>
          </view>
          <view wx:else class="image-placeholder" bindtap="selectImage" data-index="{{index}}">
            <text class="placeholder-icon">ğŸ–¼ï¸</text>
            <text>ç‚¹å‡»æ·»åŠ å›¾ç‰‡</text>
          </view>
          <textarea placeholder="å›¾ç‰‡æè¿°ï¼ˆå¯é€‰ï¼‰" 
                    value="{{item.description}}"
                    bindinput="onImageDescriptionInput"
                    data-index="{{index}}"
                    class="image-description">
          </textarea>
        </view>

        <!-- é‡ç‚¹å¡ç‰‡ -->
        <view wx:elif="{{item.type === 'highlight'}}" class="highlight-content">
          <input placeholder="é‡ç‚¹æ ‡é¢˜" 
                 value="{{item.title}}"
                 bindinput="onHighlightTitleInput"
                 data-index="{{index}}"
                 class="highlight-title"/>
          <view class="highlight-points">
            <view wx:for="{{item.points}}" wx:key="pointIndex" wx:for-item="point" wx:for-index="pointIndex" class="point-item">
              <text class="point-bullet">â€¢</text>
              <input placeholder="é‡ç‚¹å†…å®¹" 
                     value="{{point}}"
                     bindinput="onPointInput"
                     data-index="{{index}}"
                     data-point-index="{{pointIndex}}"
                     class="point-input"/>
              <text class="delete-point" 
                    bindtap="deletePoint" 
                    data-index="{{index}}" 
                    data-point-index="{{pointIndex}}">Ã—</text>
            </view>
            <text class="add-point" bindtap="addPoint" data-index="{{index}}">+ æ·»åŠ é‡ç‚¹</text>
          </view>
        </view>

      </view>
    </view>
  </scroll-view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-fab" bindtap="showAddMenu">+</view>

  <!-- æ·»åŠ èœå• -->
  <view class="add-menu {{showAddMenu ? 'show' : ''}}" wx:if="{{showAddMenu}}">
    <view class="menu-overlay" bindtap="hideAddMenu"></view>
    <view class="menu-content">
      <text class="menu-title">é€‰æ‹©å†…å®¹ç±»å‹</text>
      <view class="menu-options">
        <view class="menu-option" bindtap="addCard" data-type="video">
          <text class="option-icon">ğŸ“¹</text>
          <text>è§†é¢‘</text>
        </view>
        <view class="menu-option" bindtap="addCard" data-type="text">
          <text class="option-icon">ğŸ“</text>
          <text>æ–‡æœ¬</text>
        </view>
        <view class="menu-option" bindtap="addCard" data-type="image">
          <text class="option-icon">ğŸ–¼ï¸</text>
          <text>å›¾ç‰‡</text>
        </view>
        <view class="menu-option" bindtap="addCard" data-type="highlight">
          <text class="option-icon">âš¡</text>
          <text>é‡ç‚¹</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
  <view class="preview-modal {{showPreview ? 'show' : ''}}" wx:if="{{showPreview}}">
    <view class="preview-content">
      <view class="preview-header">
        <text class="preview-title">å†…å®¹é¢„è§ˆ</text>
        <text class="close-btn" bindtap="closePreview">Ã—</text>
      </view>
      <scroll-view class="preview-body" scroll-y>
        <text class="preview-course-title">{{courseInfo.title}}</text>
        <text class="preview-course-subtitle">{{courseInfo.subtitle}}</text>
        
        <view wx:for="{{contentCards}}" wx:key="id" class="preview-card">
          <!-- é¢„è§ˆè§†é¢‘ -->
          <view wx:if="{{item.type === 'video' && item.videoUrl}}" class="preview-video">
            <video src="{{item.videoUrl}}" controls class="preview-video-player"></video>
            <view class="preview-stats">
              <text>ğŸ¬ {{item.duration}}</text>
              <text>ğŸ‘¥ {{item.views}}</text>
            </view>
          </view>
          
          <!-- é¢„è§ˆæ–‡æœ¬ -->
          <view wx:elif="{{item.type === 'text'}}" class="preview-text">
            <text class="preview-text-title">{{item.title}}</text>
            <text class="preview-text-content">{{item.content}}</text>
          </view>
          
          <!-- é¢„è§ˆå›¾ç‰‡ -->
          <view wx:elif="{{item.type === 'image' && item.imageUrl}}" class="preview-image">
            <image src="{{item.imageUrl}}" mode="aspectFill" class="preview-image-display"></image>
            <text wx:if="{{item.description}}" class="preview-image-desc">{{item.description}}</text>
          </view>
          
          <!-- é¢„è§ˆé‡ç‚¹ -->
          <view wx:elif="{{item.type === 'highlight'}}" class="preview-highlight">
            <view class="preview-highlight-header">
              <text class="highlight-icon">âš¡</text>
              <text class="highlight-title">{{item.title}}</text>
            </view>
            <view class="highlight-list">
              <view wx:for="{{item.points}}" wx:key="pointIndex" class="highlight-point">
                <text class="point-bullet">â€¢</text>
                <text>{{item}}</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- åº•éƒ¨å·¥å…·æ  -->
  <view class="bottom-toolbar">
    <button class="toolbar-btn" bindtap="showPreview">é¢„è§ˆ</button>
    <button class="toolbar-btn" bindtap="clearAll">æ¸…ç©º</button>
    <button class="toolbar-btn primary" bindtap="saveContent">ä¿å­˜</button>
  </view>
</view>
